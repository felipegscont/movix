import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  console.log('üå± Iniciando seed do banco de dados...');

  // Estados brasileiros
  console.log('üìç Criando estados...');
  const estados = [
    { codigo: '12', uf: 'AC', nome: 'Acre', regiao: 'Norte' },
    { codigo: '27', uf: 'AL', nome: 'Alagoas', regiao: 'Nordeste' },
    { codigo: '16', uf: 'AP', nome: 'Amap√°', regiao: 'Norte' },
    { codigo: '13', uf: 'AM', nome: 'Amazonas', regiao: 'Norte' },
    { codigo: '29', uf: 'BA', nome: 'Bahia', regiao: 'Nordeste' },
    { codigo: '23', uf: 'CE', nome: 'Cear√°', regiao: 'Nordeste' },
    { codigo: '53', uf: 'DF', nome: 'Distrito Federal', regiao: 'Centro-Oeste' },
    { codigo: '32', uf: 'ES', nome: 'Esp√≠rito Santo', regiao: 'Sudeste' },
    { codigo: '52', uf: 'GO', nome: 'Goi√°s', regiao: 'Centro-Oeste' },
    { codigo: '21', uf: 'MA', nome: 'Maranh√£o', regiao: 'Nordeste' },
    { codigo: '51', uf: 'MT', nome: 'Mato Grosso', regiao: 'Centro-Oeste' },
    { codigo: '50', uf: 'MS', nome: 'Mato Grosso do Sul', regiao: 'Centro-Oeste' },
    { codigo: '31', uf: 'MG', nome: 'Minas Gerais', regiao: 'Sudeste' },
    { codigo: '15', uf: 'PA', nome: 'Par√°', regiao: 'Norte' },
    { codigo: '25', uf: 'PB', nome: 'Para√≠ba', regiao: 'Nordeste' },
    { codigo: '41', uf: 'PR', nome: 'Paran√°', regiao: 'Sul' },
    { codigo: '26', uf: 'PE', nome: 'Pernambuco', regiao: 'Nordeste' },
    { codigo: '22', uf: 'PI', nome: 'Piau√≠', regiao: 'Nordeste' },
    { codigo: '33', uf: 'RJ', nome: 'Rio de Janeiro', regiao: 'Sudeste' },
    { codigo: '24', uf: 'RN', nome: 'Rio Grande do Norte', regiao: 'Nordeste' },
    { codigo: '43', uf: 'RS', nome: 'Rio Grande do Sul', regiao: 'Sul' },
    { codigo: '11', uf: 'RO', nome: 'Rond√¥nia', regiao: 'Norte' },
    { codigo: '14', uf: 'RR', nome: 'Roraima', regiao: 'Norte' },
    { codigo: '42', uf: 'SC', nome: 'Santa Catarina', regiao: 'Sul' },
    { codigo: '35', uf: 'SP', nome: 'S√£o Paulo', regiao: 'Sudeste' },
    { codigo: '28', uf: 'SE', nome: 'Sergipe', regiao: 'Nordeste' },
    { codigo: '17', uf: 'TO', nome: 'Tocantins', regiao: 'Norte' },
  ];

  for (const estado of estados) {
    await prisma.estado.upsert({
      where: { uf: estado.uf },
      update: {},
      create: estado,
    });
  }

  // Alguns munic√≠pios importantes
  console.log('üèôÔ∏è Criando munic√≠pios...');
  const estadoSP = await prisma.estado.findUnique({ where: { uf: 'SP' } });
  const estadoRJ = await prisma.estado.findUnique({ where: { uf: 'RJ' } });
  const estadoMG = await prisma.estado.findUnique({ where: { uf: 'MG' } });
  const estadoMA = await prisma.estado.findUnique({ where: { uf: 'MA' } });
  const estadoGO = await prisma.estado.findUnique({ where: { uf: 'GO' } });

  if (!estadoSP || !estadoRJ || !estadoMG || !estadoMA || !estadoGO) {
    throw new Error('Estados n√£o encontrados');
  }

  const municipios = [
    { codigo: '3550308', nome: 'S√£o Paulo', estadoId: estadoSP.id },
    { codigo: '3304557', nome: 'Rio de Janeiro', estadoId: estadoRJ.id },
    { codigo: '3106200', nome: 'Belo Horizonte', estadoId: estadoMG.id },
    { codigo: '2105302', nome: 'Imperatriz', estadoId: estadoMA.id },
    { codigo: '2104552', nome: 'Governador Edison Lob√£o', estadoId: estadoMA.id },
    { codigo: '5208707', nome: 'Goi√¢nia', estadoId: estadoGO.id },
  ];

  for (const municipio of municipios) {
    await prisma.municipio.upsert({
      where: { codigo: municipio.codigo },
      update: {},
      create: municipio,
    });
  }

  // NCMs b√°sicos
  console.log('üì¶ Criando NCMs...');
  const ncms = [
    { codigo: '44152000', descricao: 'Paletes, coleiras e outras plataformas para carga, de madeira', unidade: 'UN' },
    { codigo: '87164000', descricao: 'Reboques e semi-reboques, para qualquer ve√≠culo; outros ve√≠culos n√£o autopropulsados', unidade: 'UN' },
    { codigo: '84716000', descricao: 'Unidades de entrada ou de sa√≠da, podendo conter, no mesmo corpo, unidades de mem√≥ria', unidade: 'UN' },
    { codigo: '85171200', descricao: 'Telefones para redes celulares ou para outras redes sem fio', unidade: 'UN' },
  ];

  for (const ncm of ncms) {
    await prisma.nCM.upsert({
      where: { codigo: ncm.codigo },
      update: {},
      create: ncm,
    });
  }

  // CFOPs b√°sicos
  console.log('üî¢ Criando CFOPs...');
  const cfops = [
    { codigo: '5101', descricao: 'Venda de produ√ß√£o do estabelecimento', aplicacao: 'Dentro do estado', tipo: 'Sa√≠da' },
    { codigo: '5102', descricao: 'Venda de mercadoria adquirida ou recebida de terceiros', aplicacao: 'Dentro do estado', tipo: 'Sa√≠da' },
    { codigo: '6101', descricao: 'Venda de produ√ß√£o do estabelecimento', aplicacao: 'Fora do estado', tipo: 'Sa√≠da' },
    { codigo: '6102', descricao: 'Venda de mercadoria adquirida ou recebida de terceiros', aplicacao: 'Fora do estado', tipo: 'Sa√≠da' },
    { codigo: '1101', descricao: 'Compra para industrializa√ß√£o ou produ√ß√£o rural', aplicacao: 'Dentro do estado', tipo: 'Entrada' },
    { codigo: '1102', descricao: 'Compra para comercializa√ß√£o', aplicacao: 'Dentro do estado', tipo: 'Entrada' },
  ];

  for (const cfop of cfops) {
    await prisma.cFOP.upsert({
      where: { codigo: cfop.codigo },
      update: {},
      create: cfop,
    });
  }

  // CSOSNs do Simples Nacional
  console.log('üèõÔ∏è Criando CSOSNs...');
  const csosns = [
    { codigo: '101', descricao: 'Tributada pelo Simples Nacional com permiss√£o de cr√©dito' },
    { codigo: '102', descricao: 'Tributada pelo Simples Nacional sem permiss√£o de cr√©dito' },
    { codigo: '103', descricao: 'Isen√ß√£o do ICMS no Simples Nacional para faixa de receita bruta' },
    { codigo: '201', descricao: 'Tributada pelo Simples Nacional com permiss√£o de cr√©dito e com cobran√ßa do ICMS por substitui√ß√£o tribut√°ria' },
    { codigo: '202', descricao: 'Tributada pelo Simples Nacional sem permiss√£o de cr√©dito e com cobran√ßa do ICMS por substitui√ß√£o tribut√°ria' },
    { codigo: '203', descricao: 'Isen√ß√£o do ICMS no Simples Nacional para faixa de receita bruta e com cobran√ßa do ICMS por substitui√ß√£o tribut√°ria' },
    { codigo: '300', descricao: 'Imune' },
    { codigo: '400', descricao: 'N√£o tributada pelo Simples Nacional' },
    { codigo: '500', descricao: 'ICMS cobrado anteriormente por substitui√ß√£o tribut√°ria (substitu√≠do) ou por antecipa√ß√£o' },
    { codigo: '900', descricao: 'Outros' },
  ];

  for (const csosn of csosns) {
    await prisma.cSOSN.upsert({
      where: { codigo: csosn.codigo },
      update: {},
      create: csosn,
    });
  }

  // CSTs b√°sicos
  console.log('üìä Criando CSTs...');
  // Limpar CSTs existentes
  await prisma.cST.deleteMany({});

  const csts = [
    // ICMS
    { codigo: '00', descricao: 'Tributada integralmente', tipo: 'ICMS' },
    { codigo: '10', descricao: 'Tributada e com cobran√ßa do ICMS por substitui√ß√£o tribut√°ria', tipo: 'ICMS' },
    { codigo: '20', descricao: 'Com redu√ß√£o de base de c√°lculo', tipo: 'ICMS' },
    { codigo: '30', descricao: 'Isenta ou n√£o tributada e com cobran√ßa do ICMS por substitui√ß√£o tribut√°ria', tipo: 'ICMS' },
    { codigo: '40', descricao: 'Isenta', tipo: 'ICMS' },
    { codigo: '41', descricao: 'N√£o tributada', tipo: 'ICMS' },
    { codigo: '50', descricao: 'Suspens√£o', tipo: 'ICMS' },
    { codigo: '51', descricao: 'Diferimento', tipo: 'ICMS' },
    { codigo: '60', descricao: 'ICMS cobrado anteriormente por substitui√ß√£o tribut√°ria', tipo: 'ICMS' },
    { codigo: '70', descricao: 'Com redu√ß√£o de base de c√°lculo e cobran√ßa do ICMS por substitui√ß√£o tribut√°ria', tipo: 'ICMS' },
    { codigo: '90', descricao: 'Outras', tipo: 'ICMS' },
    
    // PIS
    { codigo: '01', descricao: 'Opera√ß√£o Tribut√°vel (base de c√°lculo = valor da opera√ß√£o al√≠quota normal)', tipo: 'PIS' },
    { codigo: '02', descricao: 'Opera√ß√£o Tribut√°vel (base de c√°lculo = valor da opera√ß√£o al√≠quota diferenciada)', tipo: 'PIS' },
    { codigo: '49', descricao: 'Outras Opera√ß√µes de Sa√≠da', tipo: 'PIS' },
    
    // COFINS
    { codigo: '01', descricao: 'Opera√ß√£o Tribut√°vel (base de c√°lculo = valor da opera√ß√£o al√≠quota normal)', tipo: 'COFINS' },
    { codigo: '02', descricao: 'Opera√ß√£o Tribut√°vel (base de c√°lculo = valor da opera√ß√£o al√≠quota diferenciada)', tipo: 'COFINS' },
    { codigo: '49', descricao: 'Outras Opera√ß√µes de Sa√≠da', tipo: 'COFINS' },
    
    // IPI
    { codigo: '00', descricao: 'Entrada com recupera√ß√£o de cr√©dito', tipo: 'IPI' },
    { codigo: '49', descricao: 'Outras entradas', tipo: 'IPI' },
    { codigo: '50', descricao: 'Sa√≠da tributada', tipo: 'IPI' },
    { codigo: '99', descricao: 'Outras sa√≠das', tipo: 'IPI' },
  ];

  await prisma.cST.createMany({
    data: csts,
    skipDuplicates: true,
  });

  // Naturezas de Opera√ß√£o
  console.log('üìã Criando Naturezas de Opera√ß√£o...');

  // Buscar CFOPs para relacionar
  const cfop5102 = await prisma.cFOP.findUnique({ where: { codigo: '5102' } });
  const cfop6102 = await prisma.cFOP.findUnique({ where: { codigo: '6102' } });
  const cfop5101 = await prisma.cFOP.findUnique({ where: { codigo: '5101' } });
  const cfop6101 = await prisma.cFOP.findUnique({ where: { codigo: '6101' } });

  const naturezas = [
    {
      codigo: 'VENDA',
      descricao: 'Venda de mercadoria',
      cfopDentroEstadoId: cfop5102?.id,
      cfopForaEstadoId: cfop6102?.id,
      tipoOperacao: 1, // Sa√≠da
      finalidade: 1, // Normal
      consumidorFinal: 1, // Sim
      presencaComprador: 1, // Presencial
    },
    {
      codigo: 'VENDA_PROD',
      descricao: 'Venda de produ√ß√£o do estabelecimento',
      cfopDentroEstadoId: cfop5101?.id,
      cfopForaEstadoId: cfop6101?.id,
      tipoOperacao: 1, // Sa√≠da
      finalidade: 1, // Normal
      consumidorFinal: 1, // Sim
      presencaComprador: 1, // Presencial
    },
  ];

  for (const natureza of naturezas) {
    await prisma.naturezaOperacao.upsert({
      where: { codigo: natureza.codigo },
      update: {},
      create: natureza,
    });
  }

  console.log('‚úÖ Seed conclu√≠do com sucesso!');
}

main()
  .catch((e) => {
    console.error('‚ùå Erro durante o seed:', e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
